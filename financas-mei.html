<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinançaMEI - Gestão Financeira para MEI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💼</text></svg>">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary);
            color: white;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            transition: all 0.3s;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .sidebar-menu {
            padding: 15px 0;
        }

        .sidebar-menu a {
            padding: 12px 20px;
            display: block;
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--secondary);
        }

        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: all 0.3s;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            padding: 15px 20px;
            background: var(--light);
            border-bottom: 1px solid #ddd;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-body {
            padding: 20px;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
        }

        .dashboard-card i {
            font-size: 30px;
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .dashboard-card h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .dashboard-card p {
            color: #666;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background: var(--light);
            font-weight: 600;
        }

        .table tr:hover {
            background: #f9f9f9;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-danger {
            background: var(--danger);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: white;
        }

        .badge-primary {
            background: var(--primary);
            color: white;
        }

        .progress {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--success);
            transition: width 0.3s;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid var(--secondary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .alert-success {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1100;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .goal-item, .planning-item, .contact-item {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }

        .health-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .health-green { background: var(--success); }
        .health-yellow { background: var(--warning); }
        .health-red { background: var(--danger); }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 3000;
            display: none;
        }

        .windows-shortcuts {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px 15px;
            margin: 10px 0;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 0;
            }
            .sidebar.active {
                width: var(--sidebar-width);
            }
            .main-content {
                margin-left: 0;
            }
            .menu-toggle {
                display: block;
            }
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Menu Mobile -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>FinançaMEI</h2>
            <p>Gestão Financeira</p>
        </div>
        <div class="sidebar-menu">
            <a href="#" class="active" data-tab="dashboard"><i class="fas fa-home"></i> Dashboard</a>
            <a href="#" data-tab="transactions"><i class="fas fa-exchange-alt"></i> Entradas e Saídas</a>
            <a href="#" data-tab="goals"><i class="fas fa-bullseye"></i> Metas Financeiras</a>
            <a href="#" data-tab="planning"><i class="fas fa-calendar-alt"></i> Planejamento</a>
            <a href="#" data-tab="reports"><i class="fas fa-chart-bar"></i> Relatórios</a>
            <a href="#" data-tab="mei"><i class="fas fa-user-tie"></i> Área MEI</a>
            <a href="#" data-tab="contacts"><i class="fas fa-address-book"></i> Contatos</a>
            <a href="#" data-tab="dre"><i class="fas fa-file-invoice-dollar"></i> DRE</a>
            <a href="#" data-tab="settings"><i class="fas fa-cog"></i> Configurações</a>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <div class="main-content">
        <div class="header">
            <h1 class="page-title" id="pageTitle">Dashboard</h1>
            <div class="user-menu">
                <button class="btn btn-primary" id="addTransactionBtn">
                    <i class="fas fa-plus"></i> Nova Transação
                </button>
                <div class="user-info">
                    <i class="fas fa-user-circle"></i> MEI
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="tab-content active" id="dashboard">
            <div class="windows-shortcuts">
                <strong>💡 Dicas para Windows:</strong> Use <kbd>Ctrl+S</kbd> para salvar | <kbd>Ctrl+E</kbd> para exportar backup
            </div>

            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <i class="fas fa-wallet"></i>
                    <h3 id="currentBalance">R$ 5.250,00</h3>
                    <p>Saldo Atual</p>
                </div>
                <div class="dashboard-card">
                    <i class="fas fa-arrow-up positive"></i>
                    <h3 class="positive" id="monthlyIncome">R$ 8.500,00</h3>
                    <p>Receita do Mês</p>
                </div>
                <div class="dashboard-card">
                    <i class="fas fa-arrow-down negative"></i>
                    <h3 class="negative" id="monthlyExpenses">R$ 3.250,00</h3>
                    <p>Despesas do Mês</p>
                </div>
                <div class="dashboard-card">
                    <i class="fas fa-bullseye"></i>
                    <h3 id="goalsProgress">65%</h3>
                    <p>Progresso de Metas</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span>Fluxo de Caixa - Últimos 6 Meses</span>
                    <select id="periodSelect">
                        <option value="monthly">Mensal</option>
                        <option value="weekly">Semanal</option>
                        <option value="quarterly">Trimestral</option>
                    </select>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="cashFlowChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="row" style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div class="card" style="flex: 1; min-width: 300px;">
                    <div class="card-header">
                        <span>Transações Recentes</span>
                        <a href="#" data-tab="transactions">Ver Todas</a>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Descrição</th>
                                    <th>Categoria</th>
                                    <th>Valor</th>
                                </tr>
                            </thead>
                            <tbody id="recentTransactions">
                                <!-- Preenchido por JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card" style="flex: 1; min-width: 300px;">
                    <div class="card-header">
                        <span>Metas em Andamento</span>
                        <a href="#" data-tab="goals">Ver Todas</a>
                    </div>
                    <div class="card-body">
                        <div id="goalsList">
                            <!-- Preenchido por JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Outras abas (mantidas do código anterior) -->
        <div class="tab-content" id="transactions">
            <div class="card">
                <div class="card-header">
                    <span>Entradas e Saídas de Caixa</span>
                    <button class="btn btn-primary" id="newTransactionBtn">
                        <i class="fas fa-plus"></i> Nova Transação
                    </button>
                </div>
                <div class="card-body">
                    <div class="tabs">
                        <div class="tab active" data-type="all">Todas</div>
                        <div class="tab" data-type="income">Receitas</div>
                        <div class="tab" data-type="expense">Despesas</div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descrição</th>
                                <th>Categoria</th>
                                <th>Forma Pag.</th>
                                <th>Contato</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTable">
                            <!-- Preenchido por JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Metas Financeiras -->
        <div class="tab-content" id="goals">
            <div class="card">
                <div class="card-header">
                    <span>Metas Financeiras</span>
                    <button class="btn btn-success" id="newGoalBtn">
                        <i class="fas fa-plus"></i> Nova Meta
                    </button>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i> Acompanhe seu progresso em direção às suas metas financeiras
                    </div>
                    <div id="goalsContainer">
                        <!-- Preenchido por JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Planejamento -->
        <div class="tab-content" id="planning">
            <div class="card">
                <div class="card-header">
                    <span>Planejamento Financeiro</span>
                    <button class="btn btn-primary" id="newPlanningBtn">
                        <i class="fas fa-plus"></i> Novo Agendamento
                    </button>
                </div>
                <div class="card-body">
                    <div class="alert alert-success">
                        <i class="fas fa-calendar-check"></i> Você tem <strong>3</strong> transações agendadas para os próximos 30 dias
                    </div>
                    <div id="planningContainer">
                        <!-- Preenchido por JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Relatórios -->
        <div class="tab-content" id="reports">
            <div class="card">
                <div class="card-header">
                    <span>Relatórios e Análises</span>
                    <div>
                        <button class="btn btn-warning" id="exportPdfBtn">
                            <i class="fas fa-file-pdf"></i> Exportar PDF
                        </button>
                        <button class="btn btn-success" id="exportExcelBtn">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="tabs">
                        <div class="tab active" data-report="categories">Por Categoria</div>
                        <div class="tab" data-report="monthly">Por Mês</div>
                        <div class="tab" data-report="contacts">Por Cliente/Fornecedor</div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="reportsChart"></canvas>
                    </div>
                    
                    <div class="row" style="display: flex; gap: 20px; margin-top: 20px;">
                        <div class="card" style="flex: 1;">
                            <div class="card-header">
                                <span>Top Receitas</span>
                            </div>
                            <div class="card-body">
                                <div id="topIncomes">
                                    <!-- Preenchido por JavaScript -->
                                </div>
                            </div>
                        </div>
                        <div class="card" style="flex: 1;">
                            <div class="card-header">
                                <span>Top Despesas</span>
                            </div>
                            <div class="card-body">
                                <div id="topExpenses">
                                    <!-- Preenchido por JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Área MEI -->
        <div class="tab-content" id="mei">
            <div class="card">
                <div class="card-header">
                    <span>Área do MEI</span>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>Limite de Faturamento Anual:</strong> R$ 81.000,00
                    </div>
                    
                    <div class="dashboard-cards">
                        <div class="dashboard-card">
                            <i class="fas fa-chart-line"></i>
                            <h3>R$ 48.500,00</h3>
                            <p>Faturamento Anual</p>
                            <div class="progress">
                                <div class="progress-bar" style="width: 60%; background: #f39c12;"></div>
                            </div>
                            <small>60% do limite utilizado</small>
                        </div>
                        <div class="dashboard-card">
                            <i class="fas fa-receipt"></i>
                            <h3>R$ 67,00</h3>
                            <p>Próximo DAS</p>
                            <small>Vence em 15 dias</small>
                        </div>
                        <div class="dashboard-card">
                            <i class="fas fa-calendar-day"></i>
                            <h3>2</h3>
                            <p>Obrigações Pendentes</p>
                            <small>Próximos 30 dias</small>
                        </div>
                    </div>

                    <div class="row" style="display: flex; gap: 20px; margin-top: 20px;">
                        <div class="card" style="flex: 1;">
                            <div class="card-header">
                                <span>Próximos Vencimentos</span>
                            </div>
                            <div class="card-body">
                                <div id="meiDeadlines">
                                    <!-- Preenchido por JavaScript -->
                                </div>
                            </div>
                        </div>
                        <div class="card" style="flex: 1;">
                            <div class="card-header">
                                <span>Links Úteis</span>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <a href="https://www8.receita.fazenda.gov.br/SimplesNacional/Aplicacoes/ATSPO/pgmei.app/Identificacao" 
                                       target="_blank" class="btn btn-primary">
                                        <i class="fas fa-external-link-alt"></i> Emitir DAS
                                    </a>
                                    <a href="https://www8.receita.fazenda.gov.br/SimplesNacional/Aplicacoes/ATSPO/dasn.app/Identificacao" 
                                       target="_blank" class="btn btn-warning">
                                        <i class="fas fa-file-alt"></i> Declaração Anual
                                    </a>
                                    <a href="https://www.gov.br/empresas-e-negocios/pt-br/empreendedor" 
                                       target="_blank" class="btn btn-success">
                                        <i class="fas fa-question-circle"></i> Portal do Empreendedor
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contatos -->
        <div class="tab-content" id="contacts">
            <div class="card">
                <div class="card-header">
                    <span>Lista de Contatos</span>
                    <button class="btn btn-primary" id="newContactBtn">
                        <i class="fas fa-plus"></i> Novo Contato
                    </button>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <input type="text" class="form-control" id="contactSearch" placeholder="Pesquisar contato...">
                    </div>
                    <div id="contactsContainer">
                        <!-- Preenchido por JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- DRE -->
        <div class="tab-content" id="dre">
            <div class="card">
                <div class="card-header">
                    <span>DRE - Demonstrativo de Resultados</span>
                    <select id="drePeriod">
                        <option value="2023-10">Outubro 2023</option>
                        <option value="2023-09">Setembro 2023</option>
                        <option value="2023-08">Agosto 2023</option>
                    </select>
                </div>
                <div class="card-body">
                    <div class="health-indicator health-green"></div>
                    <span class="positive"><strong>Situação: Saudável</strong></span>
                    
                    <table class="table" style="margin-top: 20px;">
                        <tbody id="dreTable">
                            <!-- Preenchido por JavaScript -->
                        </tbody>
                    </table>
                    
                    <div class="chart-container">
                        <canvas id="dreChart"></canvas>
                    </div>
                    
                    <div class="alert alert-success">
                        <i class="fas fa-chart-line"></i> 
                        <strong>Crescimento:</strong> Seu lucro líquido cresceu 12% em relação ao mês anterior
                    </div>
                </div>
            </div>
        </div>

        <!-- Configurações -->
        <div class="tab-content" id="settings">
            <div class="card">
                <div class="card-header">
                    <span>Configurações e Segurança</span>
                </div>
                <div class="card-body">
                    <div class="windows-shortcuts">
                        <strong>🛠️ Gerenciamento de Dados:</strong> Seus dados são salvos automaticamente no seu navegador
                    </div>

                    <div class="row" style="display: flex; gap: 20px;">
                        <div class="card" style="flex: 1;">
                            <div class="card-header">
                                <span>Segurança</span>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label>Senha de Acesso</label>
                                    <input type="password" class="form-control" value="••••••••">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Solicitar senha ao abrir o app
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox"> Usar biometria (se disponível)
                                    </label>
                                </div>
                                <button class="btn btn-primary">Salvar Configurações</button>
                            </div>
                        </div>
                        
                        <div class="card" style="flex: 1;">
                            <div class="card-header">
                                <span>Backup</span>
                            </div>
                            <div class="card-body">
                                <p>Último backup: <strong>Hoje, 14:30</strong></p>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Backup automático diário
                                    </label>
                                </div>
                                <button class="btn btn-success" onclick="exportBackup()">
                                    <i class="fas fa-cloud-upload-alt"></i> Fazer Backup Agora
                                </button>
                                <button class="btn btn-warning" style="margin-top: 10px;" onclick="document.getElementById('importFile').click()">
                                    <i class="fas fa-cloud-download-alt"></i> Restaurar Backup
                                </button>
                                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importBackup(this.files[0])">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Gerenciamento de Dados -->
                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <span>Gerenciamento de Dados</span>
                        </div>
                        <div class="card-body">
                            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                                <button class="btn btn-success" onclick="exportBackup()">
                                    <i class="fas fa-download"></i> Exportar Backup
                                </button>
                                <button class="btn btn-warning" onclick="document.getElementById('importFile').click()">
                                    <i class="fas fa-upload"></i> Importar Backup
                                </button>
                                <button class="btn btn-danger" onclick="clearAllData()">
                                    <i class="fas fa-trash"></i> Limpar Todos os Dados
                                </button>
                            </div>
                            
                            <div style="margin-top: 15px; font-size: 14px; color: #666;">
                                <p><strong>Último salvamento:</strong> <span id="lastSaveTime">Carregando...</span></p>
                                <p><strong>Total de transações:</strong> <span id="totalTransactions">0</span></p>
                                <p><strong>Total de contatos:</strong> <span id="totalContacts">0</span></p>
                                <p><strong>Total de metas:</strong> <span id="totalGoals">0</span></p>
                                <p><strong>Local de armazenamento:</strong> Navegador (localStorage)</p>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <span>Sincronização</span>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary">
                                <i class="fab fa-google"></i> Login com Google
                            </button>
                            <p style="margin-top: 10px; font-size: 14px; color: #666;">
                                Sincronize seus dados entre celular e computador
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Nova Transação -->
        <div class="modal" id="transactionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
            <div class="card" style="width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
                <div class="card-header">
                    <span id="modalTitle">Nova Transação</span>
                    <button class="btn btn-danger" id="closeModal">&times;</button>
                </div>
                <div class="card-body">
                    <form id="transactionForm">
                        <div class="form-group">
                            <label for="type">Tipo</label>
                            <select class="form-control" id="type" required>
                                <option value="income">Receita</option>
                                <option value="expense">Despesa</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">Valor (R$)</label>
                            <input type="number" class="form-control" id="amount" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Descrição</label>
                            <input type="text" class="form-control" id="description" required>
                        </div>
                        <div class="form-group">
                            <label for="category">Categoria</label>
                            <select class="form-control" id="category" required>
                                <option value="">Selecione uma categoria</option>
                                <!-- Preenchido por JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentMethod">Forma de Pagamento</label>
                            <select class="form-control" id="paymentMethod" required>
                                <option value="cash">Dinheiro</option>
                                <option value="debit">Cartão de Débito</option>
                                <option value="credit">Cartão de Crédito</option>
                                <option value="transfer">Transferência</option>
                                <option value="pix">PIX</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contact">Vincular a Contato (Opcional)</label>
                            <select class="form-control" id="contact">
                                <option value="">Nenhum</option>
                                <!-- Preenchido por JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="date">Data</label>
                            <input type="date" class="form-control" id="date" required>
                        </div>
                        <div class="form-group" style="text-align: right;">
                            <button type="button" class="btn btn-danger" id="cancelTransaction">Cancelar</button>
                            <button type="submit" class="btn btn-success">Salvar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Indicador de Salvamento -->
    <div class="save-indicator" id="saveIndicator">
        <i class="fas fa-check"></i> Dados salvos!
    </div>

    <script>
        // =============================================
        // SISTEMA DE SALVAMENTO AUTOMÁTICO
        // =============================================

        // Chave para salvar no localStorage
        const STORAGE_KEY = 'financaMeiData';

        // Dados padrão (serão usados apenas se não houver dados salvos)
        const defaultData = {
            transactions: [
                { id: 1, type: 'income', amount: 1500.00, description: 'Venda Produto A', category: 'Vendas', paymentMethod: 'pix', contact: 'Cliente X', date: '2023-10-15' },
                { id: 2, type: 'expense', amount: 350.00, description: 'Compra de insumos', category: 'Insumos', paymentMethod: 'transfer', contact: 'Fornecedor Y', date: '2023-10-14' },
                { id: 3, type: 'income', amount: 2200.00, description: 'Serviço prestado', category: 'Serviços', paymentMethod: 'cash', contact: 'Cliente Z', date: '2023-10-12' },
                { id: 4, type: 'expense', amount: 120.00, description: 'Almoço com cliente', category: 'Alimentação', paymentMethod: 'credit', contact: '', date: '2023-10-10' }
            ],
            categories: {
                income: ['Vendas', 'Serviços', 'Investimentos', 'Outros'],
                expense: ['Insumos', 'Alimentação', 'Transporte', 'Comunicação', 'Aluguel', 'Impostos', 'Outros']
            },
            contacts: [
                { id: 1, name: 'Cliente X', type: 'client', phone: '(11) 99999-9999', email: 'cliente@exemplo.com' },
                { id: 2, name: 'Fornecedor Y', type: 'supplier', phone: '(11) 88888-8888', email: 'fornecedor@exemplo.com' },
                { id: 3, name: 'Cliente Z', type: 'client', phone: '(11) 77777-7777', email: '' }
            ],
            goals: [
                { id: 1, name: 'Faturamento Mensal', target: 10000, current: 8500, category: 'Vendas', deadline: '2023-10-31' },
                { id: 2, name: 'Reserva de Caixa', target: 5000, current: 3200, category: 'Reserva', deadline: '2023-12-31' },
                { id: 3, name: 'Redução de Custos', target: 2000, current: 1800, category: 'Despesas', deadline: '2023-11-30' }
            ],
            planning: [
                { id: 1, type: 'expense', description: 'Pagamento DAS', amount: 67.00, date: '2023-11-10', status: 'pending' },
                { id: 2, type: 'income', description: 'Pagamento Cliente A', amount: 2500.00, date: '2023-11-05', status: 'pending' },
                { id: 3, type: 'expense', description: 'Aluguel', amount: 800.00, date: '2023-11-03', status: 'pending' }
            ],
            meiDeadlines: [
                { description: 'Pagamento DAS', date: '2023-11-10', amount: 67.00 },
                { description: 'Declaração Anual', date: '2024-04-30', amount: 0 }
            ],
            dre: {
                receitaBruta: 8500,
                deducoes: 200,
                receitaLiquida: 8300,
                custosVariaveis: 3200,
                lucroBruto: 5100,
                despesasFixas: 1850,
                lucroOperacional: 3250,
                impostos: 67,
                lucroLiquido: 3183
            },
            settings: {
                currency: 'BRL',
                backupAuto: true,
                requirePassword: false
            },
            lastSave: new Date().toISOString()
        };

        // Variável global para os dados da aplicação
        let appData = {};

        // =============================================
        // FUNÇÕES DE SALVAMENTO
        // =============================================

        // Salvar dados no localStorage
        function saveData() {
            try {
                appData.lastSave = new Date().toISOString();
                localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
                showSaveIndicator();
                console.log('✅ Dados salvos com sucesso!');
                updateDataManagementUI();
                return true;
            } catch (error) {
                console.error('❌ Erro ao salvar dados:', error);
                alert('Erro ao salvar dados. Seu navegador pode não suportar esta funcionalidade.');
                return false;
            }
        }

        // Carregar dados do localStorage
        function loadData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    
                    // Migração de versões antigas
                    if (!parsed.settings) parsed.settings = defaultData.settings;
                    if (!parsed.lastSave) parsed.lastSave = new Date().toISOString();
                    if (!parsed.meiDeadlines) parsed.meiDeadlines = defaultData.meiDeadlines;
                    if (!parsed.dre) parsed.dre = defaultData.dre;
                    
                    return parsed;
                }
                return defaultData;
            } catch (error) {
                console.error('❌ Erro ao carregar dados:', error);
                return defaultData;
            }
        }

        // Mostrar indicador de salvamento
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            if (indicator) {
                indicator.style.display = 'block';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 2000);
            }
        }

        // Backup manual dos dados
        function exportBackup() {
            try {
                const dataStr = JSON.stringify(appData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `backup-financas-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                alert('✅ Backup exportado com sucesso!');
            } catch (error) {
                console.error('❌ Erro ao exportar backup:', error);
                alert('Erro ao exportar backup.');
            }
        }

        // Restaurar backup
        function importBackup(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validar estrutura básica dos dados
                    if (!importedData.transactions || !importedData.categories) {
                        throw new Error('Arquivo inválido');
                    }
                    
                    if (confirm('Deseja substituir todos os dados atuais por este backup?')) {
                        appData = importedData;
                        saveData();
                        alert('Backup importado com sucesso! A página será recarregada.');
                        location.reload();
                    }
                } catch (error) {
                    console.error('❌ Erro ao importar backup:', error);
                    alert('Arquivo de backup inválido ou corrompido.');
                }
            };
            reader.readAsText(file);
        }

        // Limpar todos os dados
        function clearAllData() {
            if (confirm('⚠️ ATENÇÃO: Esta ação irá apagar TODOS os seus dados permanentemente. Tem certeza?')) {
                if (confirm('✅ Para confirmar, clique em OK novamente. Esta ação não pode ser desfeita.')) {
                    localStorage.removeItem(STORAGE_KEY);
                    alert('Todos os dados foram apagados. A página será recarregada.');
                    location.reload();
                }
            }
        }

        // =============================================
        // FUNÇÕES PRINCIPAIS MODIFICADAS
        // =============================================

        function saveTransaction() {
            const formData = {
                id: Date.now(),
                type: document.getElementById('type').value,
                amount: parseFloat(document.getElementById('amount').value),
                description: document.getElementById('description').value,
                category: document.getElementById('category').value,
                paymentMethod: document.getElementById('paymentMethod').value,
                contact: document.getElementById('contact').value,
                date: document.getElementById('date').value
            };
            
            appData.transactions.push(formData);
            
            if (saveData()) {
                transactionModal.style.display = 'none';
                loadRecentTransactions();
                loadTransactionsTable();
                updateDashboardCalculations();
            }
        }

        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transação?')) {
                const index = appData.transactions.findIndex(t => t.id === id);
                if (index !== -1) {
                    appData.transactions.splice(index, 1);
                    if (saveData()) {
                        loadRecentTransactions();
                        loadTransactionsTable();
                        updateDashboardCalculations();
                    }
                }
            }
        }

        // =============================================
        // FUNÇÕES DE ATUALIZAÇÃO
        // =============================================

        function updateDashboardCalculations() {
            const totalIncome = appData.transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const totalExpenses = appData.transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const balance = totalIncome - totalExpenses;
            
            const currentBalance = document.getElementById('currentBalance');
            const monthlyIncome = document.getElementById('monthlyIncome');
            const monthlyExpenses = document.getElementById('monthlyExpenses');
            
            if (currentBalance) currentBalance.textContent = `R$ ${balance.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            if (monthlyIncome) monthlyIncome.textContent = `R$ ${totalIncome.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            if (monthlyExpenses) monthlyExpenses.textContent = `R$ ${totalExpenses.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        }

        function updateDataManagementUI() {
            const lastSaveTime = document.getElementById('lastSaveTime');
            const totalTransactions = document.getElementById('totalTransactions');
            const totalContacts = document.getElementById('totalContacts');
            const totalGoals = document.getElementById('totalGoals');
            
            if (lastSaveTime) lastSaveTime.textContent = new Date(appData.lastSave).toLocaleString();
            if (totalTransactions) totalTransactions.textContent = appData.transactions.length;
            if (totalContacts) totalContacts.textContent = appData.contacts.length;
            if (totalGoals) totalGoals.textContent = appData.goals.length;
        }

        // =============================================
        // ELEMENTOS DOM E INICIALIZAÇÃO
        // =============================================

        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        const pageTitle = document.getElementById('pageTitle');
        const tabContents = document.querySelectorAll('.tab-content');
        const sidebarLinks = document.querySelectorAll('.sidebar-menu a');
        const transactionModal = document.getElementById('transactionModal');
        const transactionForm = document.getElementById('transactionForm');
        const closeModal = document.getElementById('closeModal');
        const cancelTransaction = document.getElementById('cancelTransaction');
        const addTransactionBtn = document.getElementById('addTransactionBtn');
        const newTransactionBtn = document.getElementById('newTransactionBtn');
        const recentTransactions = document.getElementById('recentTransactions');
        const transactionsTable = document.getElementById('transactionsTable');
        const goalsList = document.getElementById('goalsList');
        const categorySelect = document.getElementById('category');
        const contactSelect = document.getElementById('contact');
        const typeSelect = document.getElementById('type');

        document.addEventListener('DOMContentLoaded', function() {
            // Carregar dados salvos
            appData = loadData();
            console.log('📊 Dados carregados:', appData);
            
            // Configurações iniciais
            updateDashboardCalculations();
            updateDataManagementUI();
            
            // Event listeners
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });

            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                    
                    pageTitle.textContent = this.textContent.trim();
                    
                    // Carregar dados específicos da aba
                    if (tabId === 'goals') loadGoalsPage();
                    if (tabId === 'planning') loadPlanningPage();
                    if (tabId === 'reports') loadReportsPage();
                    if (tabId === 'mei') loadMeiPage();
                    if (tabId === 'contacts') loadContactsPage();
                    if (tabId === 'dre') loadDrePage();
                    
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('active');
                    }
                });
            });

            [addTransactionBtn, newTransactionBtn].forEach(btn => {
                btn.addEventListener('click', function() {
                    openTransactionModal();
                });
            });

            [closeModal, cancelTransaction].forEach(btn => {
                btn.addEventListener('click', function() {
                    transactionModal.style.display = 'none';
                });
            });

            transactionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveTransaction();
            });

            typeSelect.addEventListener('change', updateCategories);

            // Carregar dados iniciais
            updateCategories();
            updateContacts();
            loadRecentTransactions();
            loadTransactionsTable();
            loadGoals();
            initializeCharts();

            // Atalhos de teclado para Windows
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveData();
                }
                
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    exportBackup();
                }
            });

            console.log('💾 Sistema de salvamento ativo para Windows');
        });

        // =============================================
        // FUNÇÕES DE CARREGAMENTO DE DADOS
        // =============================================

        function loadRecentTransactions() {
            if (!recentTransactions) return;
            
            recentTransactions.innerHTML = '';
            
            const sortedTransactions = [...appData.transactions].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            sortedTransactions.slice(0, 5).forEach(transaction => {
                const row = document.createElement('tr');
                
                const date = new Date(transaction.date);
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                
                const amountClass = transaction.type === 'income' ? 'positive' : 'negative';
                const amountPrefix = transaction.type === 'income' ? '+' : '-';
                const formattedAmount = `R$ ${transaction.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${transaction.description}</td>
                    <td>${transaction.category}</td>
                    <td class="${amountClass}">${amountPrefix} ${formattedAmount}</td>
                `;
                
                recentTransactions.appendChild(row);
            });
        }

        function loadTransactionsTable() {
            if (!transactionsTable) return;
            
            transactionsTable.innerHTML = '';
            
            appData.transactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                const date = new Date(transaction.date);
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
                
                const amountClass = transaction.type === 'income' ? 'positive' : 'negative';
                const amountPrefix = transaction.type === 'income' ? '+' : '-';
                const formattedAmount = `R$ ${transaction.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${transaction.description}</td>
                    <td>${transaction.category}</td>
                    <td>${formatPaymentMethod(transaction.paymentMethod)}</td>
                    <td>${transaction.contact || '-'}</td>
                    <td class="${amountClass}">${amountPrefix} ${formattedAmount}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editTransaction(${transaction.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteTransaction(${transaction.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                transactionsTable.appendChild(row);
            });
        }

        function loadGoals() {
            if (!goalsList) return;
            
            goalsList.innerHTML = '';
            
            appData.goals.forEach(goal => {
                const progress = (goal.current / goal.target) * 100;
                let progressClass = 'badge-success';
                
                if (progress < 50) {
                    progressClass = 'badge-danger';
                } else if (progress < 80) {
                    progressClass = 'badge-warning';
                }
                
                const goalElement = document.createElement('div');
                goalElement.className = 'goal-item';
                
                goalElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <strong>${goal.name}</strong>
                        <span class="badge ${progressClass}">${progress.toFixed(0)}%</span>
                    </div>
                    <div style="font-size: 14px; color: #666;">
                        R$ ${goal.current.toLocaleString('pt-BR', {minimumFractionDigits: 2})} / R$ ${goal.target.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Meta: ${goal.category} • Vence: ${formatDate(goal.deadline)}
                    </div>
                `;
                
                goalsList.appendChild(goalElement);
            });
        }

        // [MANTENHA AS DEMAIS FUNÇÕES load...Page DO CÓDIGO ANTERIOR]
        // Apenas substitua "sampleData" por "appData" nelas

        function loadGoalsPage() {
            const container = document.getElementById('goalsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            appData.goals.forEach(goal => {
                const progress = (goal.current / goal.target) * 100;
                let progressClass = 'badge-success';
                let progressColor = '#2ecc71';
                
                if (progress < 50) {
                    progressClass = 'badge-danger';
                    progressColor = '#e74c3c';
                } else if (progress < 80) {
                    progressClass = 'badge-warning';
                    progressColor = '#f39c12';
                }
                
                const goalElement = document.createElement('div');
                goalElement.className = 'goal-item';
                
                goalElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <strong>${goal.name}</strong>
                            <span class="badge ${progressClass}" style="margin-left: 10px;">${progress.toFixed(0)}%</span>
                        </div>
                        <div>
                            <button class="btn btn-primary btn-sm" onclick="editGoal(${goal.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteGoal(${goal.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div style="font-size: 14px; color: #666; margin-bottom: 5px;">
                        R$ ${goal.current.toLocaleString('pt-BR', {minimumFractionDigits: 2})} / R$ ${goal.target.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                        <span style="float: right;">Faltam: R$ ${(goal.target - goal.current).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: ${progress}%; background: ${progressColor};"></div>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Categoria: ${goal.category} • Vence: ${formatDate(goal.deadline)}
                    </div>
                `;
                
                container.appendChild(goalElement);
            });
        }

        function loadPlanningPage() {
            const container = document.getElementById('planningContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            appData.planning.forEach(item => {
                const daysUntil = Math.ceil((new Date(item.date) - new Date()) / (1000 * 60 * 60 * 24));
                let statusClass = 'badge-warning';
                let statusText = 'Pendente';
                
                if (daysUntil < 0) {
                    statusClass = 'badge-danger';
                    statusText = 'Atrasado';
                } else if (daysUntil === 0) {
                    statusText = 'Hoje';
                } else if (daysUntil <= 3) {
                    statusText = 'Próximo';
                }
                
                const itemElement = document.createElement('div');
                itemElement.className = 'planning-item';
                
                itemElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <div>
                            <strong>${item.description}</strong>
                            <span class="badge ${item.type === 'income' ? 'badge-success' : 'badge-danger'}" style="margin-left: 10px;">
                                ${item.type === 'income' ? 'Receita' : 'Despesa'}
                            </span>
                            <span class="badge ${statusClass}" style="margin-left: 5px;">${statusText}</span>
                        </div>
                        <div>
                            <strong class="${item.type === 'income' ? 'positive' : 'negative'}">
                                ${item.type === 'income' ? '+' : '-'} R$ ${item.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                            </strong>
                        </div>
                    </div>
                    <div style="font-size: 14px; color: #666;">
                        Data: ${formatDate(item.date)} 
                        <span style="margin-left: 15px;">
                            ${daysUntil === 0 ? 'Vence hoje' : daysUntil < 0 ? `Atrasado ${Math.abs(daysUntil)} dias` : `Em ${daysUntil} dias`}
                        </span>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary btn-sm" onclick="editPlanning(${item.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-success btn-sm" onclick="markPaid(${item.id})">
                            <i class="fas fa-check"></i> Marcar como Pago
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deletePlanning(${item.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                `;
                
                container.appendChild(itemElement);
            });
        }

        function loadReportsPage() {
            const ctx = document.getElementById('reportsChart').getContext('2d');
            if (window.reportsChart) {
                window.reportsChart.destroy();
            }
            
            window.reportsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Vendas', 'Serviços', 'Insumos', 'Alimentação', 'Transporte', 'Outros'],
                    datasets: [{
                        data: [40, 35, 15, 5, 3, 2],
                        backgroundColor: [
                            '#2ecc71', '#3498db', '#e74c3c', '#f39c12', '#9b59b6', '#34495e'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            const topIncomes = document.getElementById('topIncomes');
            const topExpenses = document.getElementById('topExpenses');
            
            if (topIncomes) {
                topIncomes.innerHTML = `
                    <div style="padding: 5px 0;"><i class="fas fa-circle positive"></i> Vendas - R$ 3.400,00</div>
                    <div style="padding: 5px 0;"><i class="fas fa-circle positive"></i> Serviços - R$ 2.800,00</div>
                    <div style="padding: 5px 0;"><i class="fas fa-circle positive"></i> Consultoria - R$ 1.200,00</div>
                `;
            }
            
            if (topExpenses) {
                topExpenses.innerHTML = `
                    <div style="padding: 5px 0;"><i class="fas fa-circle negative"></i> Insumos - R$ 1.200,00</div>
                    <div style="padding: 5px 0;"><i class="fas fa-circle negative"></i> Aluguel - R$ 800,00</div>
                    <div style="padding: 5px 0;"><i class="fas fa-circle negative"></i> Transporte - R$ 350,00</div>
                `;
            }
        }

        function loadMeiPage() {
            const deadlinesContainer = document.getElementById('meiDeadlines');
            if (!deadlinesContainer) return;
            
            deadlinesContainer.innerHTML = '';
            
            appData.meiDeadlines.forEach(deadline => {
                const daysUntil = Math.ceil((new Date(deadline.date) - new Date()) / (1000 * 60 * 60 * 24));
                
                const deadlineElement = document.createElement('div');
                deadlineElement.className = 'planning-item';
                
                deadlineElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${deadline.description}</strong>
                            <div style="font-size: 14px; color: #666;">
                                Vencimento: ${formatDate(deadline.date)}
                                <span style="margin-left: 10px; color: ${daysUntil <= 7 ? '#e74c3c' : '#f39c12'}">
                                    ${daysUntil === 0 ? 'Vence hoje' : daysUntil < 0 ? `Atrasado ${Math.abs(daysUntil)} dias` : `Em ${daysUntil} dias`}
                                </span>
                            </div>
                        </div>
                        <div>
                            ${deadline.amount > 0 ? `<strong>R$ ${deadline.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong>` : ''}
                        </div>
                    </div>
                    ${deadline.description.includes('DAS') ? `
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary btn-sm" onclick="window.open('https://www8.receita.fazenda.gov.br/SimplesNacional/Aplicacoes/ATSPO/pgmei.app/Identificacao', '_blank')">
                            <i class="fas fa-external-link-alt"></i> Emitir DAS
                        </button>
                    </div>
                    ` : ''}
                `;
                
                deadlinesContainer.appendChild(deadlineElement);
            });
        }

        function loadContactsPage() {
            const container = document.getElementById('contactsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            appData.contacts.forEach(contact => {
                const contactElement = document.createElement('div');
                contactElement.className = 'contact-item';
                
                const initials = contact.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                contactElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="contact-avatar">${initials}</div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${contact.name}</strong>
                                    <span class="badge ${contact.type === 'client' ? 'badge-primary' : 'badge-warning'}" style="margin-left: 10px;">
                                        ${contact.type === 'client' ? 'Cliente' : 'Fornecedor'}
                                    </span>
                                </div>
                                <div>
                                    <button class="btn btn-primary btn-sm" onclick="editContact(${contact.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteContact(${contact.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div style="font-size: 14px; color: #666; margin-top: 5px;">
                                <div><i class="fas fa-phone"></i> ${contact.phone}</div>
                                ${contact.email ? `<div><i class="fas fa-envelope"></i> ${contact.email}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(contactElement);
            });
        }

        function loadDrePage() {
            const dreTable = document.getElementById('dreTable');
            if (!dreTable) return;
            
            const dre = appData.dre;
            
            dreTable.innerHTML = `
                <tr>
                    <td><strong>Receita Bruta</strong></td>
                    <td>R$ ${dre.receitaBruta.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                </tr>
                <tr>
                    <td>(-) Deduções (taxas, devoluções)</td>
                    <td>R$ ${dre.deducoes.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                </tr>
                <tr style="border-top: 2px solid #ddd;">
                    <td><strong>Receita Líquida</strong></td>
                    <td><strong>R$ ${dre.receitaLiquida.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong></td>
                </tr>
                <tr>
                    <td>(-) Custos Variáveis (insumos, transporte)</td>
                    <td>R$ ${dre.custosVariaveis.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                </tr>
                <tr style="border-top: 2px solid #ddd;">
                    <td><strong>Lucro Bruto</strong></td>
                    <td><strong>R$ ${dre.lucroBruto.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong></td>
                </tr>
                <tr>
                    <td>(-) Despesas Fixas (aluguel, energia, etc.)</td>
                    <td>R$ ${dre.despesasFixas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                </tr>
                <tr style="border-top: 2px solid #ddd;">
                    <td><strong>Lucro Operacional</strong></td>
                    <td><strong>R$ ${dre.lucroOperacional.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong></td>
                </tr>
                <tr>
                    <td>(-) Impostos e Contribuições (DAS)</td>
                    <td>R$ ${dre.impostos.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                </tr>
                <tr style="border-top: 2px solid #ddd; background: #f8f9fa;">
                    <td><strong>Lucro Líquido do Mês</strong></td>
                    <td><strong class="positive">R$ ${dre.lucroLiquido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong></td>
                </tr>
            `;
            
            const ctx = document.getElementById('dreChart').getContext('2d');
            if (window.dreChart) {
                window.dreChart.destroy();
            }
            
            window.dreChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jul', 'Ago', 'Set', 'Out'],
                    datasets: [{
                        label: 'Lucro Líquido',
                        data: [2500, 2800, 2950, 3183],
                        backgroundColor: '#2ecc71'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // =============================================
        // FUNÇÕES AUXILIARES
        // =============================================

        function updateCategories() {
            const type = typeSelect.value;
            const categories = appData.categories[type];
            
            categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        function updateContacts() {
            contactSelect.innerHTML = '<option value="">Nenhum</option>';
            
            appData.contacts.forEach(contact => {
                const option = document.createElement('option');
                option.value = contact.name;
                option.textContent = `${contact.name} (${contact.type === 'client' ? 'Cliente' : 'Fornecedor'})`;
                contactSelect.appendChild(option);
            });
        }

        function formatPaymentMethod(method) {
            const methods = {
                'cash': 'Dinheiro',
                'debit': 'Cartão Débito',
                'credit': 'Cartão Crédito',
                'transfer': 'Transferência',
                'pix': 'PIX'
            };
            return methods[method] || method;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
        }

        function editTransaction(id) {
            const transaction = appData.transactions.find(t => t.id === id);
            if (transaction) {
                openTransactionModal(transaction);
            }
        }

        function openTransactionModal(transaction = null) {
            const modalTitle = document.getElementById('modalTitle');
            
            if (transaction) {
                modalTitle.textContent = 'Editar Transação';
                document.getElementById('type').value = transaction.type;
                document.getElementById('amount').value = transaction.amount;
                document.getElementById('description').value = transaction.description;
                document.getElementById('category').value = transaction.category;
                document.getElementById('paymentMethod').value = transaction.paymentMethod;
                document.getElementById('contact').value = transaction.contact;
                document.getElementById('date').value = transaction.date;
            } else {
                modalTitle.textContent = 'Nova Transação';
                transactionForm.reset();
                document.getElementById('date').valueAsDate = new Date();
            }
            
            transactionModal.style.display = 'flex';
            updateCategories();
        }

        function initializeCharts() {
            const ctx = document.getElementById('cashFlowChart').getContext('2d');
            window.cashFlowChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro'],
                    datasets: [
                        {
                            label: 'Receitas',
                            data: [6500, 7200, 8100, 7800, 8500, 9000],
                            backgroundColor: '#2ecc71'
                        },
                        {
                            label: 'Despesas',
                            data: [4200, 4500, 4800, 5200, 4700, 5000],
                            backgroundColor: '#e74c3c'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': R$ ' + context.raw.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Funções para outras abas (simuladas)
        function newGoal() {
            alert('Funcionalidade: Nova Meta - Em desenvolvimento');
        }

        function newPlanning() {
            alert('Funcionalidade: Novo Agendamento - Em desenvolvimento');
        }

        function newContact() {
            alert('Funcionalidade: Novo Contato - Em desenvolvimento');
        }

        function exportPdf() {
            alert('PDF gerado com sucesso!');
        }

        function exportExcel() {
            alert('Planilha Excel exportada com sucesso!');
        }

        function editGoal(id) {
            alert(`Editando meta ${id}`);
        }

        function deleteGoal(id) {
            if (confirm('Tem certeza que deseja excluir esta meta?')) {
                alert(`Meta ${id} excluída`);
            }
        }

        function editPlanning(id) {
            alert(`Editando agendamento ${id}`);
        }

        function markPaid(id) {
            alert(`Agendamento ${id} marcado como pago`);
        }

        function deletePlanning(id) {
            if (confirm('Tem certeza que deseja excluir este agendamento?')) {
                alert(`Agendamento ${id} excluído`);
            }
        }

        function editContact(id) {
            alert(`Editando contato ${id}`);
        }

        function deleteContact(id) {
            if (confirm('Tem certeza que deseja excluir este contato?')) {
                alert(`Contato ${id} excluído`);
            }
        }

        // Fechar modal ao clicar fora
        window.addEventListener('click', function(e) {
            if (e.target === transactionModal) {
                transactionModal.style.display = 'none';
            }
        });
    </script>
</body>
</html>